
<!doctype html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="">

    <title>The NBDC-DDBJ imputation server job configuration</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="https://getbootstrap.com/docs/4.0/examples/offcanvas/offcanvas.css" rel="stylesheet">

    <style>
        body {
  font-family: 'Inter', 'Segoe UI', 'Roboto', 'Droid Sans', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
        label {
            margin-top: 0.2rem;
        }
    </style>
</head>

<body class="bg-light">
    <a href="/accessdemo/logout">Logout</a>
    <form enctype="multipart/form-data" action="./new_ui" method="POST" id="wholegenomeform">

        <!-- TODO: check these libraries include inside head -->
        <!-- jQuery を読み込む -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
    
    <!-- jsTreeライブラリを読み込む -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.11/themes/default/style.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.11/jstree.min.js" defer></script>
    


<main role="main" class="container">
      <div class="masthead">
        <h3 class="text-muted">The NBDC-DDBJ imputation server job configuration</h3>
      </div>

    <!-- top -->
    <div class="d-flex align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
        <div class="form-group lh-100 w-100">
            <label for="target_vcf">Target VCF file:
                <span class="badge text-light bg-danger">* required</span>
            </label>

            <button class="btn btn-primary" type="button" id="getSelectionButton">選択項目のファイルを指定する</button>
            <div id="filePath">Please select a Target VCF File</div>
        
            <!-- HTML内でjsTreeを表示 -->
            <div id="fileTree"></div>
    


            <label for="target_vcf">Target VCF file:
                <span class="badge text-light bg-danger">* required</span>
            </label>
            <input type="text" class="form-control" name="target_vcf" id="target_vcf" placeholder="Target VCF file path">
        </div>
    </div>

    <!-- second -->
    <div class="d-block align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
            <h6 class="mb-0 text-dark lh-100">Reference panel preset config or other:</h6>
        
    <div class="d-flex align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
        <div class="lh-100">
        <div class="lh-100">
            <h6 class="mb-0 text-dark lh-100">Reference panel preset config:
<span class="badge text-light bg-danger">* required</span>
</h6>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="reference_panel" value="GRCh37.1KGP" id="GRCh37.1KGP" checked>
                <label class="form-check-label" for="GRCh37.1KGP">
                    GRCh37.1KGP
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="reference_panel" value="GRCh37.1KGP-EAS" id="GRCh37.1KGP-EAS" >
                <label class="form-check-label" for="GRCh37.1KGP-EAS">
                    GRCh37.1KGP-EAS
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="reference_panel" value="GRCh38.1KGP" id="GRCh38.1KGP" >
                <label class="form-check-label" for="GRCh38.1KGP">
                    GRCh38.1KGP
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="reference_panel" value="GRCh38.1KGP-EAS" id="GRCh38.1KGP-EAS" >
                <label class="form-check-label" for="GRCh38.1KGP-EAS">
                    GRCh38.1KGP-EAS
                </label>
            </div>
        </div>

        </div>
    </div>
    <!-- third -->
    <div class="d-flex align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
        <div class="lh-100">
            <h6 class="mb-0 text-dark lh-100">Output genotype probability:</h6>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="output_genotype_prob"  id="output_genotype_prob_false" value="false" checked>
                <label class="form-check-label" for="output_genotype_prob_false">
                false
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="output_genotype_prob" id="output_genotype_prob_true" value="true" >
                <label class="form-check-label" for="output_genotype_prob_true">
                true
                </label>
            </div>
        </div>
    </div>
    <!-- fourth -->
    <div class="d-flex align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
        <div class="lh-100">
            <h6 class="mb-0 text-dark lh-100">Output directory:</h6>
            <!-- output -->        
            <button class="btn btn-primary" type="button" id="getDirectorySelectionButton">選択項目のディレクトリを指定する</button>
            <br>
            <div id="directoryPath">Please select an output directory</div>
        
            <!-- HTML内でjsTreeを表示 -->
            <div id="directoryTree"></div>
            Output Directory: <input type="text" id="outputDirectory" name="outputDirectory">
            <h6 class="mb-0 text-dark lh-100">Output prefix:</h6>
            <input type="text" class="form-control" name="output_prefix" id="output_prefix" placeholder="Output prefix">
        </div>
    </div>
    <!-- fifth -->
    <div class="d-flex align-items-center p-3 my-3 text-dark-50 border border-dark rounded box-shadow">
        <div class="form-group lh-100 w-100">
            <label for="num_threads">Number of threads:</label>
            <input type="text" class="form-control" name="num_threads" id="num_threads" placeholder="Number of threads" value="16">
        </div>
    </div>
    
    <!-- sixth -->
    <div class="">
        <p class="text-center">
    <button class="btn btn-primary" type="submit">Execute</button>
    </p>
    </div>
    
    <div class="mb-3">
        <label for="exampleFormControlTextarea1" class="form-label">Generated config file</label>
        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3">{{ configcontent }}</textarea>
    </div>

</main>
</form>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<!--
<script src="https://getbootstrap.com/assets/js/vendor/holder.min.js"></script>
-->
<script src="https://getbootstrap.com/docs/4.0/examples/offcanvas/offcanvas.js"></script>

<!-- jsTreeを初期化 -->
<script>
    // for file select
    $(function () {
        $('#fileTree').jstree({
            'core': {
                'data': {
                    'url': '/accessdemo/treeview/data',
                    'data': function (node) {
                        return { 'id': node.id };
                    }
                }
            },
            'types': {
                'default': {
                    'icon': 'jstree-folder'
                },
                'file': {
                    'icon': 'jstree-file'
                }
            },
            'plugins': ['types'], // チェックボックスとtypesプラグインを有効にする
        });
    });
    // ボタンクリック時に選択項目を取得
    $('#getSelectionButton').on('click', function () {
            var selectedNodes = $('#fileTree').jstree('get_selected', true);
            var selectedFiles = [];
            var selectedDirectory = "";
            var element = null;
            
            for (var i = 0; i < selectedNodes.length; i++) {
                if (selectedNodes[i].type === "file") {
                    element = selectedNodes[i];
                    selectedFiles.push(selectedNodes[i].text);
                } else if (selectedNodes[i].type === "default") {
                    selectedDirectory = selectedNodes[i].text;
                }
            }


            // 選択したディレクトリ名とファイルをコンソールに表示
            console.log("選択したディレクトリ: " + selectedDirectory);
            console.log("選択したファイル: " + selectedFiles.join(', '));
            //
            try {
                if (element.type != "file") {
                    console.log("not a file");
                }
            } catch (error) {
                console.log("not a file");
                $('#filePath').text("Please select a Target VCF File")
                return;
            }
            var path = [];
            
        // if ($("#" + element.id).hasClass("jstree-leaf") == false) {
        //     // directory path
        //     return true;
        // }

        path.push(element.text);
        $.each(element.parents, function (i, e) {
            if (e != "#") {
                path.push($("#" + e + "_anchor").text());
            }
        });
        console.log(path);
        var filePath = path.reverse().join("/");
        console.log(filePath);
        $('#filePath').text(filePath)
        $('#target_vcf').val(filePath)

    });

    // for directory select
    $(function () {
        $('#directoryTree').jstree({
            'core': {
                'data': {
                    'url': '/accessdemo/treeview/data',
                    'data': function (node) {
                        return { 'id': node.id };
                    }
                }
            },
            'types': {
                'default': {
                    'icon': 'jstree-folder'
                },
                'file': {
                    'icon': 'jstree-file'
                }
            },
            'plugins': ['types'], // チェックボックスとtypesプラグインを有効にする
        });
    });
    // ボタンクリック時に選択項目を取得
    $('#getDirectorySelectionButton').on('click', function () {
            var selectedNodes = $('#directoryTree').jstree('get_selected', true);
            var selectedFiles = [];
            var selectedDirectory = "";
            var element = null;
            
            for (var i = 0; i < selectedNodes.length; i++) {
                if (selectedNodes[i].type === "file") {
                    selectedFiles.push(selectedNodes[i].text);
                } else if (selectedNodes[i].type === "default") {
                    element = selectedNodes[i];
                    selectedDirectory = selectedNodes[i].text;
                }
            }


            // 選択したディレクトリ名とファイルをコンソールに表示
            console.log("選択したディレクトリ: " + selectedDirectory);
            console.log("選択したファイル: " + selectedFiles.join(', '));
            //
            try {
                if (element.type == "file") {
                    console.log("is a file");
                    $('#directoryPath').text("Please select an output directory")
                    return;
                }
            } catch (error) {
                console.log("not a file");
                $('#directoryPath').text("Please select an output directory")
                return;
            }
            var path = [];
            
        // if ($("#" + element.id).hasClass("jstree-leaf") == false) {
        //     // directory path
        //     return true;
        // }
            console.log(element);
        path.push(element.text);
        $.each(element.parents, function (i, e) {
            if (e != "#") {
                path.push($("#" + e + "_anchor").text());
            }
        });
        console.log(path);
        var directoryPath = path.reverse().join("/");
        console.log(directoryPath);
        $('#directoryPath').text(directoryPath);
        $('#outputDirectory').val(directoryPath);

    });


</script>

</body>
</html>
